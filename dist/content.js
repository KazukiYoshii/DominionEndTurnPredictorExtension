function getFeatures() {
    const cardVocab = [
        'no_card', 'no_colonies', 'no_shelters', 'no_landspace', 'shelters', 'colonies',
        'stockpile', 'gardens', 'bridge', 'stonemason', 'remodel', 'butcher', 'workshop',
        'fools-gold', 'animal-fair', 'moat', 'council-room', 'soothsayer', 'artisan',
        'ironworks', 'mine', 'pixie', 'hermit', 'lighthouse', 'market', 'wharf',
        'tunnel', 'merchant', 'talisman', 'jack-of-all-trades', 'haggler', 'groom',
        'silk-road', 'hoard', 'barge', 'mill', 'kiln', 'vassal', 'cellar', 'explorer',
        'smithy', 'fisherman', 'camel-train', 'bridge-troll', 'transmogrify', 'bandit',
        'fool', 'bounty-hunter', 'sheepdog', 'guardian', 'harem', 'chapel', 'falconer',
        'library', 'poacher', 'moneylender', 'peddler', 'wayfarer', 'candlestick-maker',
        'squire', 'supplies', 'haven', 'salvager', 'goatherd', 'caravan-guard', 'harbinger',
        'masterpiece', 'courtyard', 'festival', 'treasure-map', 'horn-of-plenty',
        'laboratory', 'pawn', 'menagerie', 'replace', 'island', 'amulet', 'quarry',
        'farmers-market', 'bureaucrat', 'baron', 'village', 'messenger', 'gatekeeper',
        'displace', 'remake', 'farmland', 'fortune-teller', 'venture', 'beggar', 'tragic-hero',
        'jester', 'expand', 'guide', 'royal-seal', 'steward', 'fishing-village',
        'develop', 'coin-of-the-realm', 'cache', 'feodum', 'ratcatcher', 'engineer',
        'embargo', 'caravan', 'watchtower', 'den-of-sin', 'pearl-diver', 'capital',
        'embassy', 'gear', 'duchess', 'dismantle', 'courtier', 'ill-gotten-gains',
        'trading-post', 'wine-merchant', 'nomad-camp', 'taxman', 'forager', 'navigator',
        'duke', 'gladiator', 'merchant-ship', 'sacrifice', 'harvest', 'trader',
        'horse-traders', 'forge', 'merchant-guild', 'bank', 'spices', 'graverobber',
        'snowy-village', 'trade-route', 'coven', 'treasure-trove', 'sacred-grove',
        'baker', 'counting-house', 'contraband', 'inventor', 'marauder', 'cutpurse',
        'counterfeit', 'altar', 'fairgrounds', 'armory', 'noble-brigand', 'upgrade',
        'secret-passage', 'hireling', 'night-watchman', 'poor-house', 'governor',
        'black-cat', 'market-square', 'tactician', 'scavenger', 'bard', 'lost-city',
        'raider', 'oasis', 'herbalist', 'treasury', 'faithful-hound', 'silk-merchant',
        'grand-market', 'destrier', 'duplicate', 'mandarin', 'leprechaun', 'cobbler',
        'city', 'ghost-town', 'scrap', 'procession', 'ranger', 'monument', 'mint',
        'rats', 'lurker', 'vineyard', 'charm', 'highway', 'crypt', 'conclave',
        'lackeys', 'castles', 'distant-lands', 'transmute', 'royal-blacksmith',
        'archive', 'vagrant', 'scheme', 'journeyman', 'vault', 'lookout',
        'raze', 'warehouse', 'village-green', 'junk-dealer', 'death-cart',
        'nobles', 'oracle', 'hunting-grounds', 'diplomat', 'pillage', 'conspirator',
        'storeroom', 'prince', 'patrician', 'bazaar', 'mystic', 'herald',
        'catacombs', 'bishop', 'cursed-village', 'university', 'sleigh',
        'cemetery', 'border-village', 'sage', 'workers-village', 'temple', 'changeling',
        'pirate-ship', 'port', 'throne-room', 'necromancer', 'cartographer', 'walled-village',
        'paddock', 'farming-village', 'rabble', 'native-village', 'improve', 'sentry',
        'miser', 'shanty-town', 'patrol', 'count', 'wishing-well', 'giant', 'druid',
        'skulk', 'mining-village', 'haunted-woods', 'monastery', 'hamlet', 'loan',
        'idol', 'settlers', 'devils-workshop', 'apprentice', 'relic', 'enchantress',
        'villa', 'masquerade', 'livery', 'envoy', 'philosophers-stone', 'magpie',
        'tracker', 'pooka', 'plaza', 'rogue', 'crossroads', 'spice-merchant',
        'hostelry', 'sanctuary', 'royal-carriage', 'hunting-lodge', 'cargo-ship',
        'apothecary', 'tormentor', 'golem', 'bandit-camp', 'ducat', 'forum',
        'acting-troupe', 'smugglers', 'rebuild', 'sculptor', 'hunting-party',
        'blessed-village', 'swamp-hag', 'treasurer', 'patron', 'wild-hunt',
        'priest', 'doctor', 'young-witch', 'ironmonger', 'werewolf', 'dungeon',
        'swashbuckler', 'stables', 'crown', 'fortress', 'cavalry', 'artificer',
        'flag-bearer', 'witch', 'advisor', 'scholar', 'encampment', 'legionary',
        'villain', 'scepter', 'inn', 'band-of-misfits', 'research', 'experiment',
        'storyteller', 'mastermind', 'militia', 'old-witch', 'chariot-race',
        'secret-cave', 'vampire', 'alchemist', 'seer', 'hideout', 'cardinal',
        'margrave', 'minion', 'overlord', 'wandering-minstrel', 'outpost',
        'sauna', 'shepherd', 'mountain-village', 'exorcist', 'page', 'city-quarter',
        'recruiter', 'groundskeeper', 'border-guard', 'kings-court', 'sea-hag',
        'torturer', 'peasant', 'catapult', 'goons', 'scrying-pool', 'familiar',
        'mountebank', 'ghost-ship', 'ambassador', 'church', 'knights', 'cultist',
        'tower', 'urchin', 'advance', 'black-market', 'obelisk', 'borrow', 'swindler',
        'captain', 'salt-the-earth', 'trade', 'delve', 'save', 'fountain', 'wedding',
        'triumphal-arch', 'ball', 'pilgrimage', 'plan', 'alms', 'quest', 'seaway',
        'windfall', 'training', 'banquet', 'raid', 'tomb', 'museum', 'bonfire',
        'ferry', 'scouting-party', 'expedition', 'conquest', 'ritual', 'arena',
        'summon', 'labyrinth', 'travelling-fair', 'orchard', 'wolf-den', 'baths',
        'annex', 'cathedral', 'triumph', 'palace', 'aqueduct', 'guildhall', 'lost-arts',
        'defiled-shrine', 'basilica', 'exploration', 'colonnade', 'sinister-plot',
        'dominate', 'bandit-fort', 'fair', 'sewers', 'crop-rotation', 'city-gate',
        'piazza', 'canal', 'barracks', 'pathfinding', 'pageant', 'road-network',
        'star-chart', 'donate', 'capitalism', 'battlefield', 'innovation', 'tournament',
        'keep', 'academy', 'fleet', 'mountain-pass', 'tax', 'silos', 'mission',
        'inheritance', 'wall', 'citadel', 'desperation', 'ride', 'alliance', 'enclave',
        'transport', 'enhance', 'bargain', 'delay', 'commerce', 'demand', 'reap',
        'march', 'seize-the-day', 'toil', 'banish', 'way-of-the-worm', 'way-of-the-sheep',
        'stampede', 'pursue', 'way-of-the-monkey', 'way-of-the-goat', 'way-of-the-turtle',
        'way-of-the-squirrel', 'way-of-the-camel', 'way-of-the-seal', 'populate',
        'way-of-the-pig', 'way-of-the-rat', 'way-of-the-mule', 'way-of-the-owl',
        'way-of-the-otter', 'way-of-the-frog', 'way-of-the-butterfly', 'invest',
        'gamble', 'way-of-the-chameleon', 'way-of-the-mouse', 'way-of-the-mole',
        'way-of-the-ox', 'way-of-the-horse', 'possession', 'day'
    ]
    const vocab = {'no_colonies': 0,
    'colonies': 1,
    'no_shelters': 2,
    'shelters': 3,
    'road-network': 4,
    'way-of-the-frog': 5,
    'innovation': 6,
    'barracks': 7,
    'transport': 8,
    'bargain': 9,
    'populate': 10,
    'cathedral': 11,
    'seize-the-day': 12,
    'gamble': 13,
    'alms': 14,
    'banquet': 15,
    'colonnade': 16,
    'ferry': 17,
    'way-of-the-mule': 18,
    'exploration': 19,
    'delve': 20,
    'pathfinding': 21,
    'city-gate': 22,
    'toil': 23,
    'labyrinth': 24,
    'mountain-pass': 25,
    'lost-arts': 26,
    'capitalism': 27,
    'annex': 28,
    'quest': 29,
    'no_landspace': 30,
    'fair': 31,
    'donate': 32,
    'summon': 33,
    'desperation': 34,
    'pilgrimage': 35,
    'training': 36,
    'battlefield': 37,
    'borrow': 38,
    'save': 39,
    'aqueduct': 40,
    'orchard': 41,
    'alliance': 42,
    'ride': 43,
    'bandit-fort': 44,
    'obelisk': 45,
    'guildhall': 46,
    'enclave': 47,
    'academy': 48,
    'fleet': 49,
    'march': 50,
    'fountain': 51,
    'arena': 52,
    'plan': 53,
    'citadel': 54,
    'canal': 55,
    'travelling-fair': 56,
    'piazza': 57,
    'delay': 58,
    'banish': 59,
    'baths': 60,
    'defiled-shrine': 61,
    'stampede': 62,
    'way-of-the-chameleon': 63,
    'crop-rotation': 64,
    'way-of-the-camel': 65,
    'expedition': 66,
    'bonfire': 67,
    'way-of-the-pig': 68,
    'ball': 69,
    'demand': 70,
    'enhance': 71,
    'palace': 72,
    'basilica': 73,
    'way-of-the-goat': 74,
    'way-of-the-monkey': 75,
    'seaway': 76,
    'triumph': 77,
    'star-chart': 78,
    'salt-the-earth': 79,
    'sinister-plot': 80,
    'way-of-the-squirrel': 81,
    'pageant': 82,
    'invest': 83,
    'way-of-the-owl': 84,
    'ritual': 85,
    'conquest': 86,
    'advance': 87,
    'trade': 88,
    'dominate': 89,
    'tax': 90,
    'commerce': 91,
    'scouting-party': 92,
    'reap': 93,
    'way-of-the-mouse': 94,
    'windfall': 95,
    'way-of-the-ox': 96,
    'museum': 97,
    'wall': 98,
    'raid': 99,
    'way-of-the-otter': 100,
    'keep': 101,
    'triumphal-arch': 102,
    'way-of-the-horse': 103,
    'pursue': 104,
    'way-of-the-seal': 105,
    'inheritance': 106,
    'way-of-the-worm': 107,
    'mission': 108,
    'silos': 109,
    'sewers': 110,
    'way-of-the-sheep': 111,
    'wolf-den': 112,
    'way-of-the-butterfly': 113,
    'tower': 114,
    'way-of-the-mole': 115,
    'way-of-the-rat': 116,
    'tomb': 117,
    'way-of-the-turtle': 118,
    'wedding': 119,
    'acting-troupe': 120,
    'count': 121,
    'bandit-camp': 122,
    'destrier': 123,
    'bard': 124,
    'animal-fair': 125,
    'gardens': 126,
    'bank': 127,
    'coin-of-the-realm': 128,
    'displace': 129,
    'ambassador': 130,
    'candlestick-maker': 131,
    'cartographer': 132,
    'caravan-guard': 133,
    'blessed-village': 134,
    'contraband': 135,
    'bandit': 136,
    'border-village': 137,
    'advisor': 138,
    'dungeon': 139,
    'counterfeit': 140,
    'artisan': 141,
    'cavalry': 142,
    'apothecary': 143,
    'altar': 144,
    'develop': 145,
    'caravan': 146,
    'city-quarter': 147,
    'captain': 148,
    'barge': 149,
    'armory': 150,
    'amulet': 151,
    'city': 152,
    'cultist': 153,
    'duke': 154,
    'baker': 155,
    'hideout': 156,
    'black-market': 157,
    'capital': 158,
    'butcher': 159,
    'dismantle': 160,
    'conclave': 161,
    'artificer': 162,
    'cardinal': 163,
    'changeling': 164,
    'courtyard': 165,
    'bridge-troll': 166,
    'alchemist': 167,
    'forager': 168,
    'archive': 169,
    'chapel': 170,
    'island': 171,
    'castles': 172,
    'diplomat': 173,
    'band-of-misfits': 174,
    'cache': 175,
    'cemetery': 176,
    'bounty-hunter': 177,
    'devil-s-workshop': 178,
    'border-guard': 179,
    'baron': 180,
    'bureaucrat': 181,
    'catacombs': 182,
    'conspirator': 183,
    'apprentice': 184,
    'camel-train': 185,
    'fisherman': 186,
    'beggar': 187,
    'ducat': 188,
    'ghost-town': 189,
    'enchantress': 190,
    'black-cat': 191,
    'cellar': 192,
    'cobbler': 193,
    'bishop': 194,
    'doctor': 195,
    'crypt': 196,
    'crown': 197,
    'exorcist': 198,
    'den-of-sin': 199,
    'counting-house': 200,
    'bridge': 201,
    'fairgrounds': 202,
    'bazaar': 203,
    'distant-lands': 204,
    'crossroads': 205,
    'engineer': 206,
    'embassy': 207,
    'fortune-teller': 208,
    'charm': 209,
    'chariot-race': 210,
    'catapult': 211,
    'faithful-hound': 212,
    'cargo-ship': 213,
    'experiment': 214,
    'embargo': 215,
    'coven': 216,
    'cutpurse': 217,
    'council-room': 218,
    'lighthouse': 219,
    'gatekeeper': 220,
    'feodum': 221,
    'hermit': 222,
    'courtier': 223,
    'church': 224,
    'goatherd': 225,
    'falconer': 226,
    'druid': 227,
    'duchess': 228,
    'giant': 229,
    'fool-s-gold': 230,
    'duplicate': 231,
    'farming-village': 232,
    'fortress': 233,
    'death-cart': 234,
    'fool': 235,
    'explorer': 236,
    'encampment': 237,
    'highway': 238,
    'grand-market': 239,
    'haven': 240,
    'goons': 241,
    'haggler': 242,
    'cursed-village': 243,
    'forge': 244,
    'expand': 245,
    'farmers--market': 246,
    'golem': 247,
    'fishing-village': 248,
    'mine': 249,
    'ghost-ship': 250,
    'lurker': 251,
    'hoard': 252,
    'groundskeeper': 253,
    'hunting-grounds': 254,
    'herbalist': 255,
    'gear': 256,
    'hunting-party': 257,
    'groom': 258,
    'lackeys': 259,
    'envoy': 260,
    'farmland': 261,
    'flag-bearer': 262,
    'guardian': 263,
    'menagerie': 264,
    'forum': 265,
    'journeyman': 266,
    'festival': 267,
    'gladiator': 268,
    'mill': 269,
    'haunted-woods': 270,
    'harem': 271,
    'legionary': 272,
    'governor': 273,
    'familiar': 274,
    'hamlet': 275,
    'harbinger': 276,
    'inn': 277,
    'horn-of-plenty': 278,
    'merchant-guild': 279,
    'hostelry': 280,
    'graverobber': 281,
    'herald': 282,
    'miser': 283,
    'guide': 284,
    'jester': 285,
    'mastermind': 286,
    'hunting-lodge': 287,
    'inventor': 288,
    'lookout': 289,
    'kiln': 290,
    'jack-of-all-trades': 291,
    'harvest': 292,
    'oracle': 293,
    'masquerade': 294,
    'hireling': 295,
    'merchant-ship': 296,
    'idol': 297,
    'livery': 298,
    'horse-traders': 299,
    'ill-gotten-gains': 300,
    'ironmonger': 301,
    'knights': 302,
    'mining-village': 303,
    'ironworks': 304,
    'loan': 305,
    'junk-dealer': 306,
    'messenger': 307,
    'mountain-village': 308,
    'leprechaun': 309,
    'market-square': 310,
    'king-s-court': 311,
    'improve': 312,
    'merchant': 313,
    'patron': 314,
    'overlord': 315,
    'moneylender': 316,
    'magpie': 317,
    'margrave': 318,
    'mint': 319,
    'lost-city': 320,
    'laboratory': 321,
    'noble-brigand': 322,
    'library': 323,
    'militia': 324,
    'poacher': 325,
    'market': 326,
    'masterpiece': 327,
    'patrol': 328,
    'marauder': 329,
    'night-watchman': 330,
    'mandarin': 331,
    'navigator': 332,
    'nobles': 333,
    'outpost': 334,
    'minion': 335,
    'necromancer': 336,
    'shanty-town': 337,
    'monument': 338,
    'monastery': 339,
    'rebuild': 340,
    'nomad-camp': 341,
    'page': 342,
    'patrician': 343,
    'native-village': 344,
    'sage': 345,
    'peddler': 346,
    'moat': 347,
    'old-witch': 348,
    'royal-blacksmith': 349,
    'pixie': 350,
    'scavenger': 351,
    'pirate-ship': 352,
    'pawn': 353,
    'paddock': 354,
    'mystic': 355,
    'port': 356,
    'mountebank': 357,
    'pearl-diver': 358,
    'raze': 359,
    'oasis': 360,
    'pooka': 361,
    'pillage': 362,
    'poor-house': 363,
    'procession': 364,
    'sacred-grove': 365,
    'philosopher-s-stone': 366,
    'rabble': 367,
    'possession': 368,
    'plaza': 369,
    'salvager': 370,
    'ranger': 371,
    'prince': 372,
    'rogue': 373,
    'quarry': 374,
    'relic': 375,
    'priest': 376,
    'remodel': 377,
    'recruiter': 378,
    'remake': 379,
    'peasant': 380,
    'ratcatcher': 381,
    'royal-carriage': 382,
    'rats': 383,
    'sleigh': 384,
    'research': 385,
    'raider': 386,
    'seer': 387,
    'sacrifice': 388,
    'secret-cave': 389,
    'royal-seal': 390,
    'sauna': 391,
    'replace': 392,
    'scrying-pool': 393,
    'sea-hag': 394,
    'skulk': 395,
    'sculptor': 396,
    'settlers': 397,
    'scheme': 398,
    'sentry': 399,
    'scrap': 400,
    'sanctuary': 401,
    'secret-passage': 402,
    'silk-road': 403,
    'silk-merchant': 404,
    'scholar': 405,
    'snowy-village': 406,
    'scepter': 407,
    'soothsayer': 408,
    'spices': 409,
    'stables': 410,
    'shepherd': 411,
    'smugglers': 412,
    'treasurer': 413,
    'sheepdog': 414,
    'squire': 415,
    'spice-merchant': 416,
    'storeroom': 417,
    'talisman': 418,
    'supplies': 419,
    'swamp-hag': 420,
    'stockpile': 421,
    'storyteller': 422,
    'smithy': 423,
    'steward': 424,
    'throne-room': 425,
    'transmogrify': 426,
    'stonemason': 427,
    'temple': 428,
    'tournament': 429,
    'swindler': 430,
    'tunnel': 431,
    'swashbuckler': 432,
    'upgrade': 433,
    'taxman': 434,
    'treasury': 435,
    'trader': 436,
    'tactician': 437,
    'trading-post': 438,
    'tormentor': 439,
    'tracker': 440,
    'torturer': 441,
    'trade-route': 442,
    'treasure-trove': 443,
    'treasure-map': 444,
    'transmute': 445,
    'vagrant': 446,
    'tragic-hero': 447,
    'university': 448,
    'vampire': 449,
    'vault': 450,
    'urchin': 451,
    'vassal': 452,
    'walled-village': 453,
    'venture': 454,
    'villa': 455,
    'village': 456,
    'villain': 457,
    'village-green': 458,
    'wishing-well': 459,
    'wandering-minstrel': 460,
    'vineyard': 461,
    'wayfarer': 462,
    'watchtower': 463,
    'warehouse': 464,
    'werewolf': 465,
    'wharf': 466,
    'wild-hunt': 467,
    'witch': 468,
    'wine-merchant': 469,
    'worker-s-village': 470,
    'workshop': 471,
    'no_card': 472,
    'young-witch': 473,
    'day': 474}

    var mini_card_arts = document.getElementsByClassName('mini-card-art');
    var card_arts = document.getElementsByClassName('full-card-art');
    var landscape_arts = document.getElementsByClassName('landscape-art');
    var card_names = []

    var shelters = 'no_shelters'
    var colonies = 'no_colonies'
    try {
        for (var i = 0; card_arts.length; i++) {
            var card_name = card_arts[i].style.backgroundImage.split("/")[4].split(".")[0]
            //console.log(card_arts[i].style.backgroundImage.split("/")[4].split(".")[0])
            if (cardVocab.includes(card_name) && !(card_names.includes(card_name))){
                card_names.push(card_name)
            }
            if (card_name == 'overgrown-estate') {
                shelters = 'shelters'
            }
        };
    } catch (error) {}

    // 魔女娘用
    if (card_names.length <= 10) {
        card_names.push('no_card')
    }

    try {
        for (var i = 0; mini_card_arts.length; i++) {
            var card_name = mini_card_arts[i].style.backgroundImage.split("/")[4].split(".")[0]
            if (card_name == 'mini-colony') {
                colonies = 'colonies'
            }
        };
    } catch (error) {}
    card_names.push(shelters)
    card_names.push(colonies)

    var num_landspace = 0;
    try {
        for (var i = 0; landscape_arts.length; i++) {
            var card_name = landscape_arts[i].style.backgroundImage.split("/")[4].split(".")[0]
            //console.log(landscape_arts[i].style.backgroundImage.split("/")[4].split(".")[0])
            if (cardVocab.includes(card_name) && !(card_names.includes(card_name))){
                card_names.push(card_name)
                num_landspace++;
            }
        };
    } catch (error) {}

    var cnt = 2 - num_landspace;
    for (var i = 0; i < cnt; i++){
        card_names.push('no_landspace')
    }

    var player1_rate = 60.0
    var player2_rate = 60.0
    var log_line = document.getElementsByClassName('log-line');
    var tmp_player1_rate = parseFloat(log_line[0].textContent.split(': ')[1].slice( 0, 5 ))
    var tmp_player2_rate = parseFloat(log_line[0].textContent.split(': ')[2].slice( 0, 5 ))

    if (!isNaN(tmp_player1_rate)){
        player1_rate = tmp_player1_rate
    }
    if (!isNaN(tmp_player2_rate)){
        player2_rate = tmp_player2_rate
    }

    var player_rates = [player1_rate, player2_rate]
    console.log(card_names)
    //console.log(player_rates)

    let card_names_int = card_names.map(function(value){
        return vocab[value]
    })

    var data = {supply: card_names_int, player_rates: player_rates}
    console.log(data)
    return data
};

// message: {action, url}
chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
  if (message && message.action === 'GET_SUPPLY_INFO') {
    sendResponse(getFeatures());
    return true;
  }
  return true;
});
